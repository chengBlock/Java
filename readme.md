# java基本数据类型和引用数据类型内存分配

> 堆与栈是java用来在RAM中存储数据的地方，java自动管理堆和栈，程序员不能直接设置堆和栈

- 栈
  - 栈的读取速度比堆快，仅次于寄存器
  - 存在栈中的数据大小与生命周期必须是确定的，缺乏灵活性
- 堆
  - 堆可以动态分配内存大小，生存期也不必事先告诉编译器
  - gc会自动收走堆中不再使用的数据
  - 由于运行时需要动态分配内存，存取速度慢



**基本数据类型**

> `int a = 3;`a为自动变量，3为字面值，a和3在编译时都会分配到栈空间中。<u>先定义自动变量a，再将a指向字面值3的地址空间中去</u>

由于内存大小和生存周期已知（程序块），所以为了追求速度就放在了栈中。***栈中的数据是可以共享的***，即`int a = 3; int b = 3`在开始创建时，首先，编译器在栈中创建一个指向int类型的引用变量a，然后开辟一个存放3的地址空间，将a指向该地址。当创建b引用变量之后，查看栈中有3这个字面值，b就指向了该地址。当执行`a = 4;`时，a就指向字面值为4的地址空间（已有的或新开的），此时b仍然指向3。



**引用数据类型**（对象的内存模型）

> 创建一个对象包括对象的声明和实例化两步：1.<u>声明对象的引用</u> 2.<u>对象的实例化</u>

声明一个对象的引用时，将在栈内存为对象的引用变量分配空间；

对象实例化是，在堆内存中为类成员变量分配内存，并将其初始化为各数据类型默认值，接着进行显示初始化。最后调用构造方法为成员变量赋值，返回堆内存中对象的引用（相当于首地址）给应用变量，通过引用变量来引用堆内存中的对象。



**总结**: 为什么传参中，基本数据类型是值传递、引用数据类型是引用传递?

```java
int age = 1;

void setAge(int age) {
    this.age = age;
}
===================
传入参数为n
```



基本数据类型是直接将参数的字面值付给函数中的相关域，向上面提到的那样：setAge()接收到n的赋值后，n和age同时指向栈中n原本指向的字面值，当n的值发生变化时，编译器会重新开辟新空间存储新值。此时age仍指向被分配的原始值。

而引用类型的对象实例在堆中存储，当传入一个对象参数时函数内的变量就会同时指向该内存地址。所以两者代表同一个实例。

